---
slug: loader
title: webpack loader çš„åŸºæœ¬ä½¿ç”¨
sidebar_label: loader çš„åŸºæœ¬ä½¿ç”¨
tags:
  - webpack4.0
categories:
  - å‰ç«¯
  - webpack4.0å­¦ä¹ æ€»ç»“
description: >-
  webpack å…¥é—¨æ•™ç¨‹ï¼Œä»‹ç»äº† webpack loader çš„åŸºæœ¬ä½¿ç”¨ã€ä½œç”¨ã€loader çš„æ‰§è¡Œé¡ºåºã€file-loader
  å¤„ç†å›¾ç‰‡ã€css-loader å’Œ style-loaderå¤„ç† CSSã€‚
keywords:
  - webpack
  - webpack å…¥é—¨æ•™ç¨‹
  - webpack loader
  - file-loader
  - css-loader
  - style-loader
references:
  - name: ä»åŸºç¡€åˆ°å®æˆ˜ æ‰‹æŠŠæ‰‹å¸¦ä½ æŒæ¡æ–°ç‰ˆWebpack4.0
    url: 'https://coding.imooc.com/class/chapter/316.html#Anchor'
  - name: webpackå®˜ç½‘
    url: 'https://webpack.js.org/'
date: 2020-05-15T20:00:22.000Z
updated: 2020-05-16T13:33:00.000Z
sidebar_position: 2
summary: >-
  æœ¬èŠ‚ä¸»è¦ä»‹ç»äº† webpack loader çš„åŸºæœ¬ä½¿ç”¨ï¼ŒåŒ…æ‹¬ file-loaderã€url-loaderã€css-loader å’Œ
  style-loaderã€‚file-loader å¯ä»¥æ‰“åŒ…å›¾ç‰‡æ–‡ä»¶ï¼Œurl-loader å¯ä»¥å°†å›¾ç‰‡æ–‡ä»¶è½¬åŒ–ä¸º base64 ç¼–ç ï¼Œcss-loader å’Œ
  style-loader å¯ä»¥æ‰“åŒ… CSS æ–‡ä»¶ã€‚æœ€åè¿˜ä»‹ç»äº† css æ¨¡å—åŒ–ã€css å¤–éƒ¨å¼•å…¥å’Œå¤„ç†å­—ä½“æ–‡ä»¶ã€‚
---

è¿™èŠ‚ä¸»è¦è®²ä¸€è®²ä¸€äº›å¸¸è§çš„ Loader çš„ä½¿ç”¨ã€‚åŒ…æ‹¬ `file-loader`ã€`url-loader`ä»¥åŠ`css-loader`å’Œ`style-loader`ã€‚

<!--truncate-->

## Loader

### file-loader

ä¸Šä¸€èŠ‚ç®€å•ä»‹ç»äº† webpack æ˜¯ä»€ä¹ˆï¼Œwebpack æ˜¯ä¸€ä¸ªæ¨¡å—æ‰“åŒ…å™¨ï¼Œå¯ä»¥å°† es çš„æ¨¡å—æ–‡ä»¶è¿›è¡Œæ‰“åŒ…ã€‚ä¸Šä¸€èŠ‚æˆ‘ä»¬åªæ‰“åŒ…äº† js æ–‡ä»¶ï¼Œé‚£æˆ‘ä»¬èƒ½ä¸èƒ½æ‰“åŒ…å…¶ä»–ç±»å‹çš„æ–‡ä»¶å‘¢ï¼Œå…ˆæ¥è¯•ä¸€è¯•æ‰“åŒ…å›¾ç‰‡å§ã€‚

è¿™é‡Œä½¿ç”¨åˆ°äº† `file-loader`

```shell title="å®‰è£… file-loader"
npm i file-loader -D
```

<Tabs>
<TabItem value="index.js" label="index.js">

```js title="index.js"
// ES Moudule æ¨¡å—åŒ–å¼•å…¥
import ComponentB from './componentB';

var root = document.getElementById('root');

// CommonJs æ¨¡å—å¼•å…¥
var ComponentA = require('./componentA');
var img1 = require('./IMG_3294.jpg');
console.log(img1);
var img = new Image();
img.src = img1;
root.append(img);

new ComponentA();
new ComponentB();
```

</TabItem>
<TabItem value="webpack.config.js" label="webpack.config.js">

```js
const path = require('path');

module.exports = {
  mode: 'development', // é»˜è®¤ä¸ºproduction
  entry: {
    main: './src/index.js' // æ‰“åŒ…å…¥å£æ–‡ä»¶
  },
  module: {
    rules: [
      // åŒ¹é… jpg ç»“å°¾çš„æ–‡ä»¶ä½¿ç”¨ file-loader å¤„ç†
      {
        test: /\.jpg$/,
        use: {
          loader: 'file-loader'
        }
      }
    ]
  },
  output: {
    // è¾“å‡ºæ–‡ä»¶é…ç½®
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist')
  }
};
```

</TabItem>
</Tabs>

`npm run build` è¿›è¡Œæ‰“åŒ…ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æ§åˆ¶å°æ‰“å°å‡ºæ¥çš„ img1

![img module](https://raw.githubusercontent.com/3Alan/images/master/img/20200515205827.png)

è¿™é‡Œå¯ä»¥çœ‹åˆ° img1 æ˜¯ä¸€ä¸ª`Module`ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡ `img1.default` æ¥è·å–è·¯å¾„æˆ–è€…ç›´æ¥é€šè¿‡ import å½¢å¼æ¥å¼•å…¥ï¼Œè¿™æ ·å›¾ç‰‡å°±æˆåŠŸå¾—æ˜¾ç¤ºå‡ºæ¥äº† ğŸ˜„

```js
import img1 from './IMG_3294.jpg';
```

é€šè¿‡è¿™ä¸ªä¾‹å­å¯ä»¥çŸ¥é“äº† loader çš„å¤§è‡´ä½œç”¨æ–¹æ³•äº†ï¼Œé€šè¿‡ `test` æ¥åŒ¹é…ç‰¹å®šæ–‡ä»¶ä½¿ç”¨(`use`) ç‰¹å®šçš„ `loader` æ¥å¯¹æ–‡ä»¶è¿›è¡Œæ‰“åŒ…å¤„ç†ã€‚

æˆ‘ä»¬å†çœ‹ä¸€ä¸‹æ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶

```
dist
 â”œâ”€â”€ a2099657cfcaf9f019ccf08e9dc8747d.jpg
 â”œâ”€â”€ bundle.js
 â””â”€â”€ index.html
```

å‘ç°æˆ‘ä»¬çš„å›¾ç‰‡åç§°è¢«æ”¹å˜æˆäº†ä¸€é•¿ä¸²å­—ç¬¦ï¼Œé‚£æˆ‘æ€ä¹ˆè®©å®ƒä¸æ”¹å˜åå­—å‘¢ã€‚è¿™æ—¶å€™ loader çš„**options**å°±æ´¾ä¸Šç”¨åœºäº† ğŸ˜

```js title="webpack.config.js"
rules: [
  {
    test: /\.(jpg|png)$/,
    use: {
      loader: 'file-loader',
      options: {
        name: '[name].[ext]'
      }
    }
  }
];
```

è¿™é‡Œçš„ `[name]` å’Œ `[ext]` æ˜¯ loader ä¸­çš„**placeholder**,åˆ†åˆ«è¡¨ç¤ºæ–‡ä»¶çš„åå­—å’Œåç¼€åï¼Œå½“ç„¶ loader ä¸­è¿˜æœ‰å¾ˆå¤šçš„ [placeholder](https://webpack.js.org/loaders/file-loader/#placeholders)ã€‚

è®¾ç½®å¥½åè¿›è¡Œæ‰“åŒ…å¾—åˆ°å¦‚ä¸‹ç»“æœï¼Œå¯ä»¥çœ‹åˆ°æ‰“åŒ…åçš„æ–‡ä»¶åå’Œæ‰“åŒ…å‰çš„ä¿æŒä¸€è‡´äº†ã€‚

```
dist
 â”œâ”€â”€ bundle.js
 â”œâ”€â”€ IMG_3294.jpg
 â””â”€â”€ index.html
```

ç°åœ¨æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå½“æˆ‘ä»¬çš„å›¾ç‰‡ä¸€æ—¦å¤šèµ·æ¥é‚£å…¨éƒ¨æ‰“åŒ…æ”¾åœ¨æ ¹ç›®å½•ä¸‹æ‹¿å²‚ä¸æ˜¯å¾ˆä¹±ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨ options ä¸­çš„ output æ¥è®¾ç½®ç»è¿‡ loader å¤„ç†åçš„è¾“å‡ºè·¯å¾„äº†ã€‚

```js
options: {
  name: '[name].[ext]',
  outputPath: 'images/'
}
```

æ‰“åŒ…çœ‹ä¸€ä¸‹ç»“æœæˆåŠŸ ğŸ‘Œï¼Œè¿è¡Œä¸€ä¸‹ html æ–‡ä»¶å›¾ç‰‡ä¹Ÿå¯ä»¥æ­£å¸¸æ˜¾ç¤ºã€‚

```
dist
 â”œâ”€â”€ bundle.js
 â”œâ”€â”€ images
 â”‚   â””â”€â”€ IMG_3294.jpg
 â””â”€â”€ index.html
```

åˆ°è¿™é‡Œæˆ‘ä»¬å°±äº†è§£äº† **file-loader** çš„åŸºæœ¬ä½¿ç”¨äº†ã€‚

### url-loader

url-loader ä¹Ÿå¯ä»¥æ‰“åŒ…æ–‡ä»¶ï¼Œä½†æ˜¯å’Œ file-loader ä¸åŒçš„æ˜¯ï¼Œå®ƒä¼šå°†æˆ‘ä»¬çš„å›¾ç‰‡è½¬åŒ–æˆ base64 ç¼–ç ï¼Œé‚£å¦‚æœæˆ‘ä¸æƒ³è½¬åŒ–å‘¢ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ options ä¸­çš„ limit å±æ€§æ¥é™åˆ¶æ–‡ä»¶åœ¨å°äºå¤šå°‘æ—¶è½¬åŒ–æˆ base64 ç¼–ç ï¼Œä¸€æ—¦å¤§äºè¿™ä¸ªå€¼æ‰“åŒ…å‡ºæ¥çš„æ•ˆæœå°±å’Œ file-loader ä¸€æ ·äº†ã€‚

çœ‹ä¸€ä¸‹ä¾‹å­å°±æ¸…æ¥šäº†

```
npm i url-loader -D
```

è¿™é‡Œå‡†å¤‡ä¸¤ä¸ªå›¾ç‰‡ï¼Œä¸€ä¸ªå¤§å° 300kï¼Œä¸€ä¸ªå¤§å° 7k

```js title="webpack.config.js"
const path = require('path');

module.exports = {
  mode: 'development', // é»˜è®¤ä¸ºproduction
  entry: {
    main: './src/index.js' // æ‰“åŒ…å…¥å£æ–‡ä»¶
  },
  module: {
    rules: [
      {
        test: /\.(jpg|png)$/,
        use: {
          loader: 'url-loader',
          options: {
            name: '[name].[ext]',
            outputPath: 'images/',
            limit: 10240
          }
        }
      }
    ]
  },
  output: {
    // è¾“å‡ºæ–‡ä»¶é…ç½®
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist')
  }
};
```

çœ‹ä¸€ä¸‹æ‰“åŒ…åçš„æ–‡ä»¶

```
dist
 â”œâ”€â”€ bundle.js
 â”œâ”€â”€ images
 â”‚   â””â”€â”€ 300k.jpg
 â””â”€â”€ index.html
```

ç»“æœæ˜¯å¤§äº 10240 çš„ 300k.jpg æ–‡ä»¶è¢«ä»¥å›¾ç‰‡å½¢å¼æ‰“åŒ…å‡ºæ¥äº†ï¼Œé‚£ 7k.jpg æ–‡ä»¶å»å“ªäº†å‘¢ï¼Œæˆ‘ä»¬åœ¨ `bundle.js` æ–‡ä»¶ä¸­å¯ä»¥æ‰¾åˆ°äº†å®ƒï¼Œå®ƒè¢«è½¬åŒ–æˆäº† base64 ç¼–ç ã€‚

```
data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD...
```

å½“ç„¶ limit ä¹Ÿå¯ä»¥è®¾ç½®ä¸º true/falseï¼Œ[æ›´å¤šé…ç½®](https://webpack.js.org/loaders/url-loader/#limit)

æˆ‘åœ¨æ“ä½œä¸­å‘ç°äº†å¦‚æœ html ä¸­æ²¡æœ‰ä½¿ç”¨åˆ° 7k.jpgï¼Œurl-loader æ˜¯ä¸ä¼šå¯¹å®ƒè¿›è¡Œæ‰“åŒ…çš„ã€‚

:::tip
è¿™é‡Œå¹¶ä¸å»ºè®®æŠŠå¤§æ–‡ä»¶è½¬åŒ–ä¸º base64ï¼Œè¿™æ ·ä¼šå¢åŠ  bundle.js çš„ä½“ç§¯ï¼Œå¯¹é¡¹ç›®ä¼˜åŒ–ä¸å¤ªå‹å¥½
:::

### æ ·å¼æ–‡ä»¶

æ¥ç€ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ç°åœ¨æƒ³è¦ä¸ºé¡µé¢ä¸­çš„å›¾ç‰‡æ·»åŠ ä¸€äº›æ ·å¼

<Tabs>
<TabItem value="index.js" label="index.js">

```js
// ES Moudule æ¨¡å—åŒ–å¼•å…¥
import ComponentB from './componentB';
import './index.css';

var root = document.getElementById('root');

// CommonJs æ¨¡å—å¼•å…¥
var ComponentA = require('./componentA');
import img1 from './300k.jpg';
console.log(img1);

var img = new Image();
img.src = img1;
img.classList.add('circle');
root.append(img);

new ComponentA();
new ComponentB();
```

</TabItem>
<TabItem value="index.css" label="index.css">

```css
.circle {
  width: 100px;
  height: 100px;
  border-radius: 50px;
}
```

</TabItem>
</Tabs>

ç°åœ¨æˆ‘æƒ³è¦æ‰“åŒ… css æ–‡ä»¶è¯¥æ€ä¹ˆåŠå‘¢ ğŸ˜¶ï¼Œæˆ‘ä»¬è¦ç”¨åˆ°ä¸¤ä¸ª loaderï¼Œ`css-loader` å’Œ `style-loader`

å®‰è£…

```
npm i style-loader css-loader -D
```

```js title="webpack.config.js"
{
  test: /\.css$/,
  use: ['style-loader', 'css-loader']
}
```

æ‰“åŒ…æˆåŠŸï¼Œæ‰“å¼€ç½‘é¡µçœ‹ä¸€çœ‹æ•ˆæœç”Ÿæ•ˆäº†

![index.html](https://raw.githubusercontent.com/3Alan/images/master/img/image-20200515222855901.png)

è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹ style-loader å’Œ css-loader çš„ä½œç”¨ï¼Œé¦–å…ˆå®ƒä»¬æ‰§è¡Œæœ‰å…ˆåé¡ºåºçš„ï¼Œ

1. ä½¿ç”¨ css-loader å¯¹ css æ–‡ä»¶è¿›è¡Œæ‰“åŒ…
2. å†ç”¨ style-loader æŠŠæ‰“åŒ…åçš„ css æ–‡ä»¶å†…å®¹ä»¥`<style></style>`åŠ åˆ°é¡µé¢çš„ header ä¸­

![è§£é‡Šå›¾](https://raw.githubusercontent.com/3Alan/images/master/img/image-20200515223148666.png)

:::info
æœ‰æ—¶å€™æˆ‘ä»¬è¦ä¸º css åŠ ä¸Šæµè§ˆå™¨å¼•æ“å‰ç¼€-webkitï¼Œpostcss-loader å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°

```
npm i postcss-loader autoprefixer -D
```

```js title="webpack.config.js"
{
  test: /\.css$/,
  use: ['style-loader', 'css-loader', {
    loader: 'postcss-loader',
    options: {
      ident: 'postcss',
      pulgins: [
        require('autoprefixer')
      ]
    }
  }],
},
```

:::

## æ‰©å±•

### css æ¨¡å—åŒ–

å…ˆçœ‹ä¸€ä¸ªåœºæ™¯

<Tabs>
<TabItem value="index.js" label="index.js">

```js
import './index.css';
import img1 from './300k.jpg';
import ComponentA from './componentA';

var root = document.getElementById('root');

var img = new Image();
img.src = img1;
img.classList.add('circle');
root.append(img);

ComponentA();
```

</TabItem>
<TabItem value="ComponentA" label="ComponentA">

```js
import img1 from './300k.jpg';

function ComponentA() {
  var img = new Image();
  img.src = img1;
  img.classList.add('circle');
  var root = document.getElementById('root');
  root.append(img);
}

export default ComponentA;
```

</TabItem>
</Tabs>

![image-20200516121515523](https://raw.githubusercontent.com/3Alan/images/master/img/image-20200516121515523.png)

æˆ‘ä»¬çœ‹åˆ° circle æ ·å¼åŒæ ·ä½œç”¨åœ¨äº† componentA ä¸Šäº†ï¼Œä¹Ÿå°±æ˜¯è¯´ circle å·²ç»ç­‰åŒäºæ˜¯å…¨å±€æ ·å¼äº† ğŸ˜¥ã€‚è¿˜å¥½æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½® `css-loader` çš„ options æ¥ä½¿ç”¨ css çš„æ¨¡å—åŒ–æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

```js
{
  test: /\.css$/,
  use: [
    'style-loader',
    {
      loader: 'css-loader',
      options: {
        // å¼€å¯ css module
        modules: true,
      }
    }
  ],
},
```

é…ç½®å¥½åæˆ‘ä»¬åœ¨è¦ä½¿ç”¨æ ·å¼çš„åœ°æ–¹ä½¿ç”¨ä¸‹é¢è¿™ç§å†™æ³•

```js
import circle from './index.css';

img.classList.add(circle.circle);
```

è¿™æ ·æˆ‘ä»¬å†ä¿®æ”¹æ ·å¼å°±ä¸ä¼šå½±å“åˆ°å…¶ä»–åœ°æ–¹äº†ã€‚

### css å¤–éƒ¨å¼•å…¥

è¿™é‡Œä¸»è¦ä»‹ç» css-loader çš„ options `importLoaders`ã€‚

æˆ‘ä»¬åœ¨ index.css æ–‡ä»¶ä¸­å¼•å…¥å¤–éƒ¨ css æ–‡ä»¶

```css
@import './import.css';
```

å‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹å‡ ä¸ª loader å¤„ç† css æ–‡ä»¶

`['style-loader', 'css-loader', 'sass-loader', 'postcss-loader']`

å½“ webpack å¤„ç† index.css æ–‡ä»¶æ—¶æŒ‰ç…§ postcss-loader->sass-loader->css-loader é¡ºåºæ¥æ‰§è¡Œ css æ–‡ä»¶çš„

å½“é‡åˆ°@import æ—¶å¤„ç† import.css æ—¶ï¼Œå¦‚æœä¸åšå¤„ç†çš„è¯ï¼Œimport.css å°†ç›´æ¥ä» css-loader å¼€å§‹å¤„ç†çš„ï¼Œé‚£æˆ‘æƒ³è®©å®ƒä» postcss-loader ä»å¤´å¤„ç†çš„è¯å°±è¦è®¾ç½® imortLoaders æ•°ç›®äº†ã€‚

```js
{
  loader: 'css-loader',
  options: {
    importLoaders: 1,
  }
},
```

è¿™é‡Œçš„ 1 è¡¨ç¤ºå¤„ç†@import å¼•å…¥çš„ css æ–‡ä»¶æ˜¯ï¼Œå…ˆè¦è¢«å‰é¢çš„ 1 ä¸ª loader å¤„ç†ï¼Œä¹Ÿå°±æ˜¯ import.css çš„å¤„ç†é¡ºåºæ˜¯ sass-loader->css-loader-style-loaderã€‚

### å¤„ç†å­—ä½“æ–‡ä»¶

ç›´æ¥ä½¿ç”¨ `file-loader` å¤„ç†å°±å¯ä»¥äº†

<Tabs>
<TabItem value="webpack.config.js" label="webpack.config.js">

```js
{
  test: /\.(eot|ttf|svg|woff)$/,
  use: {
    loader: 'file-loader',
  },
},
```

</TabItem>
<TabItem value="index.js" label="index.js">

```js
import './font/iconfont.css';

var root = document.getElementById('root');

root.innerHTML = '<div class="iconfont icon-smile"></div>';
```

</TabItem>
<TabItem value="iconfont.css" label="iconfont.css">

```js
@font-face {font-family: "iconfont";
  src: url('iconfont.eot?t=1589604469136'); /* IE9 */
  src: url('iconfont.eot?t=1589604469136#iefix') format('embedded-opentype'), /* IE6-IE8 */
  url('data:application/x-font-woff2;charset=utf-8;base64,è¿™é‡Œbase64ä»£ç å¤ªé•¿åˆ é™¤æ‰äº†') format('woff2'),
  url('iconfont.woff?t=1589604469136') format('woff'),
  url('iconfont.ttf?t=1589604469136') format('truetype'), /* chrome, firefox, opera, Safari, Android, iOS 4.2+ */
  url('iconfont.svg?t=1589604469136#iconfont') format('svg'); /* iOS 4.1- */
}

.iconfont {
  font-family: "iconfont" !important;
  font-size: 16px;
  font-style: normal;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.icon-smile:before {
  content: "\e783";
}
```

</TabItem>
</Tabs>

ok!è¿™ç« åˆ°æ­¤ä»‹ç»ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»èƒ½å¤Ÿå¤„ç†ä¸€äº›å¸¸è§æ–‡ä»¶çš„æ‰“åŒ…äº†ï¼Œå¯¹ webpack çš„è®¤è¯†ä¹Ÿåº”è¯¥ç®—ä¸€ä¸ªç®€å•çš„å…¥é—¨äº†ã€‚ğŸ˜
