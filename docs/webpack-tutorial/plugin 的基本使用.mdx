---
slug: plugin
title: webpack plugin çš„åŸºæœ¬ä½¿ç”¨
sidebar_label: plugin çš„åŸºæœ¬ä½¿ç”¨
tags:
  - webpack4.0
categories:
  - å‰ç«¯
  - webpack4.0å­¦ä¹ æ€»ç»“
description: >-
  webpack å…¥é—¨æ•™ç¨‹ï¼Œä»‹ç»äº†webpack plugin çš„åŸºæœ¬ä½¿ç”¨ï¼ŒåŒ…æ‹¬å¸¸è§çš„
  pluginï¼ˆhtml-webpack-pluginï¼Œclean-webpack-plugin æ¸…é™¤distç›®å½• ï¼‰ï¼Œå¤šå…¥å£æ‰“åŒ…åŠé…ç½®ï¼Œsourcemap
  é…ç½®ã€‚
keywords:
  - webpack
  - webpack å…¥é—¨æ•™ç¨‹
  - webpack plugin
references:
  - name: ä»åŸºç¡€åˆ°å®æˆ˜ æ‰‹æŠŠæ‰‹å¸¦ä½ æŒæ¡æ–°ç‰ˆWebpack4.0
    url: 'https://coding.imooc.com/class/chapter/316.html#Anchor'
  - name: webpackå®˜ç½‘
    url: 'https://webpack.js.org/'
date: 2020-05-17T10:05:14.000Z
updated: 2020-05-16T13:33:00.000Z
sidebar_position: 3
summary: >-
  webpack æ’ä»¶å¯ä»¥å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆ HTML æ–‡ä»¶ï¼Œæ¸…é™¤æ‰“åŒ…ç›®å½•ï¼Œæ”¯æŒå¤šå…¥å£æ–‡ä»¶æ‰“åŒ…ï¼Œé…ç½® sourcemap æ–¹ä¾¿è°ƒè¯•ä»£ç ã€‚å¸¸ç”¨çš„æ’ä»¶åŒ…æ‹¬
  html-webpack-pluginã€clean-webpack-plugin ç­‰ã€‚
---

è¿™èŠ‚ä»‹ç»äº† webpack ä¸€äº›å¸¸ç”¨çš„ plugins çš„ä½¿ç”¨

<!--truncate-->

æˆ‘çš„æ€»ç»“ç¯‡çš„ç¬¬ä¸€èŠ‚[ä»€ä¹ˆæ˜¯ webpack](/posts/webpack-tutorial/what-is-webpack)ä¸­æåˆ°äº† `index.html` æ˜¯éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨ç§»åŠ¨åˆ°æ‰“åŒ…åçš„ `dist` ç›®å½•ä¸‹çš„ï¼Œé‚£ä¹ˆæ˜¯å¦å¯ä»¥æŠŠè¿™é¡¹å·¥ä½œäº¤ç»™ç¨‹åºæ¥å®ç°å‘¢ã€‚ğŸ¤”

è¿™ä¸ªæ—¶å€™ plugins å°±æ´¾ä¸Šäº†ç”¨åœºã€‚

## html-webpack-plugin

> The [`HtmlWebpackPlugin`](https://github.com/jantimon/html-webpack-plugin) simplifies creation of HTML files to serve your webpack bundles. This is especially useful for webpack bundles that include a hash in the filename which changes every compilation. You can either let the plugin generate an HTML file for you, supply your own template using [lodash templates](https://lodash.com/docs#template), or use your own [loader](https://webpack.js.org/loaders).

å®˜ç½‘ä»‹ç»åˆ°ï¼Œå®ƒå¯ä»¥å¸®æˆ‘ä»¬è‡ªåŠ¨åˆ›é€  HTML æ–‡ä»¶ï¼Œå¹¶ä¸”è¿˜å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„ HTML æ¨¡æ¿ã€‚

ç›´æ¥çœ‹ä¾‹å­ï¼š

```yaml title="å®‰è£…æ’ä»¶"
npm i html-webpack-plugin -D
```

```md title="é¡¹ç›®ç›®å½•"
webpacktest
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â”œâ”€â”€ src
â”‚ â””â”€â”€ index.js
â””â”€â”€ webpack.config.js
```

<Tabs>
<TabItem value="index.js" label="index.js">

```js
var root = document.getElementById('root');

root.innerHTML = '<div>Hello Webpack</div>';
```

</TabItem>
<TabItem value="webpack.config.js" label="webpack.config.js">

```js
const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');

module.exports = {
  mode: 'development', // é»˜è®¤ä¸ºproduction
  entry: {
    main: './src/index.js' // æ‰“åŒ…å…¥å£æ–‡ä»¶
  },
  output: {
    // è¾“å‡ºæ–‡ä»¶é…ç½®
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist')
  },
  plugins: [new HtmlWebpackPlugin()]
};
```

</TabItem>
</Tabs>

`npm run build`è¿›è¡Œæ‰“åŒ…çœ‹ä¸‹ç»“æœ

```
webpacktest
 â”œâ”€â”€ dist
 â”‚   â”œâ”€â”€ bundle.js
 â”‚   â””â”€â”€ index.html
 â”œâ”€â”€ package-lock.json
 â”œâ”€â”€ package.json
 â”œâ”€â”€ src
 â”‚   â””â”€â”€ index.js
 â””â”€â”€ webpack.config.js
```

HtmlWebpackPlugin æ’ä»¶è‡ªåŠ¨ä¸ºæˆ‘ä»¬åœ¨`dist`ç›®å½•ä¸‹ç”Ÿæˆäº† index.htmlï¼Œä½†æ˜¯...æµè§ˆå™¨æ‰“å¼€ index.html ä¸€çœ‹ä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚è¿™æ˜¯å’‹å›äº‹ï¼Œæ¥çœ‹ä¸€çœ‹ç”Ÿæˆçš„ index.html æ–‡ä»¶å‘ç°äº†é—®é¢˜

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Webpack App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <script src="bundle.js"></script>
  </body>
</html>
```

ç”Ÿæˆçš„æ–‡ä»¶ä¸­æ˜¯æ²¡æœ‰`#root`èŠ‚ç‚¹çš„ï¼Œé‚£æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬è¿˜éœ€è¦é…ç½®ä¸€ä¸‹ HtmlWebpackPluginï¼Œå‰é¢å®˜ç½‘çš„ä»‹ç»ä¸­ä¹Ÿæåˆ°äº†

> You can either let the plugin generate an HTML file for you, supply your own template using [lodash templates](https://lodash.com/docs#template), or use your own [loader](https://webpack.js.org/loaders)

æˆ‘ä»¬éœ€è¦è‡ªå·±æä¾›ä¸€ä¸ª HTML æ¨¡æ¿ï¼Œäºæ˜¯åœ¨ src ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª index.html ä½œä¸º HtmlWebpackPlugin æ‰“åŒ…çš„æ¨¡æ¿

<Tabs>
<TabItem value="index.html" label="index.html">

```html title="src/index.html"
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>html template</title>
  </head>
  <body>
    <div id="root"></div>
  </body>
</html>
```

</TabItem>
<TabItem value="webpack.config.js" label="webpack.config.js">

```js
plugins: [
  new HtmlWebpackPlugin({
    template: './src/index.html'
  })
];
```

</TabItem>
</Tabs>

å†æ‰“åŒ…ä¸€æ¬¡çœ‹ä¸€ä¸‹ `dist` ç›®å½•ä¸‹ç”Ÿæˆçš„ `index.html` æ–‡ä»¶å’Œæˆ‘ä»¬å®šä¹‰çš„ html æ¨¡æ¿æ˜¯ä¸€æ ·çš„äº†ã€‚

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>html template</title>
  </head>
  <body>
    <div id="root"></div>
    <script src="bundle.js"></script>
  </body>
</html>
```

æ‰“å¼€æµè§ˆå™¨å‘ç° Hello Webpack ä¹Ÿæ­£ç¡®æ˜¾ç¤ºå‡ºæ¥äº†ã€‚ğŸ‰

## clean-webpack-plugin

https://www.npmjs.com/package/clean-webpack-plugin

å®ƒçš„ä½œç”¨å°±æ˜¯åœ¨æ¯æ¬¡æ‰“åŒ…å‰ä¼šå°† webpack ä¸­é…ç½®çš„`out.path`(dist ç›®å½•)æ¸…ç©º

```
npm i clean-webpack-plugin -D
```

ä¸ºäº†éªŒè¯æ˜¯å¦æ¸…ç©ºäº† dist ç›®å½•ï¼Œæˆ‘ä»¬å…ˆåœ¨ dist ç›®å½•ä¸‹è‡ªå·±åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ my.js

```
dist
 â”œâ”€â”€ bundle.js
 â”œâ”€â”€ index.html
 â””â”€â”€ my.js
```

```js title="webpack.config.js"
const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');
const { CleanWebpackPlugin } = require('clean-webpack-plugin');

module.exports = {
  mode: 'development', // é»˜è®¤ä¸ºproduction
  entry: {
    main: './src/index.js' // æ‰“åŒ…å…¥å£æ–‡ä»¶
  },
  output: {
    // è¾“å‡ºæ–‡ä»¶é…ç½®
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist')
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: './src/index.html'
    }),
    new CleanWebpackPlugin()
  ]
};
```

`npm run build`æ‰“åŒ…

```
dist
 â”œâ”€â”€ bundle.js
 â””â”€â”€ index.html
```

æˆ‘ä»¬å‘ç°ä¹‹å‰åˆ›å»ºçš„ my.js æ–‡ä»¶å·²ç»è¢« CleanWebpackPlugin ç»™æ¸…é™¤äº†ã€‚

## å¤šå…¥å£æ–‡ä»¶

æœ‰æ—¶æˆ‘ä»¬çš„æ‰“åŒ…å…¥å£æ–‡ä»¶æœ‰å¤šä¸ªï¼Œè¿™æ—¶å€™å°±è¦é€šè¿‡è®¾ç½® entry æ¥å®Œæˆæ‰“åŒ…ã€‚å¹¶é€šè¿‡[name]å ä½ç¬¦æ¥è®¾ç½®æ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶çš„åç§°ã€‚

```js
const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');
const { CleanWebpackPlugin } = require('clean-webpack-plugin');

module.exports = {
  mode: 'development', // é»˜è®¤ä¸ºproduction
  entry: {
    main: './src/index.js', // æ‰“åŒ…å…¥å£æ–‡ä»¶
    enrty: './src/entry.js'
  },
  output: {
    // è¾“å‡ºæ–‡ä»¶é…ç½®
    filename: '[name].js',
    path: path.resolve(__dirname, 'dist')
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: './src/index.html'
    }),
    new CleanWebpackPlugin()
  ]
};
```

`npm run build`æ‰“åŒ…ç»“æœ

```
dist
 â”œâ”€â”€ enrty.js
 â”œâ”€â”€ index.html
 â””â”€â”€ main.js
```

çœ‹ä¸€çœ‹ index.html

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>html template</title>
  </head>
  <body>
    <div id="root"></div>
    <script src="main.js"></script>
    <script src="enrty.js"></script>
  </body>
</html>
```

å¯ä»¥çœ‹åˆ° HtmlWebpackPlugin å¸®æˆ‘ä»¬æŠŠ`main.js`å’Œ`entry.j`2 ä¸ªæ–‡ä»¶éƒ½è‡ªåŠ¨å¼•å…¥åˆ° html æ–‡ä»¶å½“ä¸­äº†ã€‚

åœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œä¸ºäº†ä¼˜åŒ–æœåŠ¡å™¨æ€§èƒ½ï¼Œæˆ‘ä»¬ä¼šå°†æ‰“åŒ…å¥½çš„ dist ç›®å½•ä¸­çš„ä¸€éƒ¨åˆ†æ–‡ä»¶ä¸¢åˆ° cdn ä¸­æ¥åŠ å¿«è®¿é—®é€Ÿåº¦ã€‚è¿™æ—¶å€™æˆ‘ä»¬å°±è¦å°† cdn çš„åœ°å€æ‰‹åŠ¨å¤åˆ¶åˆ°æ‰“åŒ…åçš„ html æ–‡ä»¶ä¸­äº†ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½® output çš„ publicPath æ¥å®Œæˆã€‚

```js
output: {
  // è¾“å‡ºæ–‡ä»¶é…ç½®
  filename: '[name].js',
  publicPath: 'https://cdn.example.com/assets',
  path: path.resolve(__dirname, 'dist'),
},
```

æ‰“åŒ…åçš„æ•ˆæœ

```html
<script src="https://cdn.example.com/assets/main.js"></script>
<script src="https://cdn.example.com/assets/enrty.js"></script>
```

## SourceMap

sourcemap æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ index.js æ–‡ä»¶å†…å®¹å¹¶ä¸”åœ¨ webpack é…ç½®ä¸­å…³é—­ sourcemap(devtool: 'none')

<Tabs>
<TabItem value="index.js" label="index.js">

```js
var root = document.getElementById('root');

errfun();

root.innerHTML = '<div>Hello Webpack</div>';
```

</TabItem>
<TabItem value="webpack.config.js" label="webpack.config.js">

```js
const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');
const { CleanWebpackPlugin } = require('clean-webpack-plugin');

module.exports = {
  mode: 'development', // é»˜è®¤ä¸ºproduction
  devtool: 'none',
  entry: {
    main: './src/index.js', // æ‰“åŒ…å…¥å£æ–‡ä»¶
    enrty: './src/entry.js'
  },
  output: {
    // è¾“å‡ºæ–‡ä»¶é…ç½®
    filename: '[name].js',
    path: path.resolve(__dirname, 'dist')
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: './src/index.html'
    }),
    new CleanWebpackPlugin()
  ]
};
```

</TabItem>
</Tabs>

index.js ä¸­ä½¿ç”¨äº†ä¸€ä¸ªä¸å­˜åœ¨çš„å‡½æ•° errfun()ï¼Œæ‰“åŒ…è¿è¡Œä¸€ä¸‹æ˜¯ä¼šæŠ¥é”™çš„ã€‚

![image-20200517134620514](https://raw.githubusercontent.com/3Alan/images/master/img/image-20200517134620514.png)

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬æƒ³è¦è°ƒè¯•ä»£ç ï¼Œä½†æ˜¯å®ƒè¿™é‡Œæç¤ºçš„é”™è¯¯è¡Œæ˜¯æ‰“åŒ…åçš„ main.js æ‰€åœ¨çš„ä½ç½®ï¼Œè€Œæ‰“åŒ…åçš„æ–‡ä»¶å¯è¯»æ€§å‡ ä¹ä¸º 0ï¼Œæƒ³è¦ä»ä¸­æ’æŸ¥é”™è¯¯å°†å˜å¾—å¾ˆå›°éš¾ã€‚

ç°åœ¨æˆ‘ä»¬é…ç½® sourcemap çœ‹çœ‹ã€‚

```js
devtool: 'source-map',
```

![image-20200517135446504](https://raw.githubusercontent.com/3Alan/images/master/img/image-20200517135446504.png)

é€šè¿‡å¼€å¯ source-map æˆ‘ä»¬å°±èƒ½å®šä½åˆ°é”™è¯¯æ˜¯å‡ºç°åœ¨æˆ‘ä»¬ index.js çš„ç¬¬ä¸‰è¡Œäº†ã€‚

:::warning
é…ç½®ä¸åŒ sourceMap ä¼šä¸åŒç¨‹åº¦ä¸Šå¢åŠ åº”ç”¨çš„æ‰“åŒ…æ—¶é—´æˆ–æ¶ˆè€—æ€§èƒ½
:::

å®˜ç½‘æä¾›äº†å¤šç§ sourceMap é…ç½®ï¼Œä¸åŒ sourceMap æ‰“åŒ…æ¶ˆè€—æ—¶é—´ä¸åŒï¼Œ[è¯¦æƒ…](https://webpack.js.org/configuration/devtool/)ã€‚

:::tip æ€»ç»“
sourcemap å…¶å®å°±æ˜¯ main.js å’Œ index.js ä¹‹é—´çš„ä¸€ç§æ˜ å°„å…³ç³»ï¼Œåœ¨ä»£ç å­˜åœ¨é”™è¯¯æ—¶ï¼Œå®ƒèƒ½æ ¹æ®æ˜ å°„å…³ç³»æ‰¾åˆ° index.js ä¸­çš„é”™è¯¯æ‰€åœ¨å¤„ï¼Œæœ‰åˆ©äºæˆ‘ä»¬ debug ä»£ç ã€‚
:::
