---
slug: dev-config
title: å¼€å‘ç¯å¢ƒç›¸å…³é…ç½®
tags:
  - webpack4.0
categories:
  - å‰ç«¯
  - webpack4.0å­¦ä¹ æ€»ç»“
references:
  - name: ä»åŸºç¡€åˆ°å®æˆ˜ æ‰‹æŠŠæ‰‹å¸¦ä½ æŒæ¡æ–°ç‰ˆWebpack4.0
    url: 'https://coding.imooc.com/class/chapter/316.html#Anchor'
  - name: webpackå®˜ç½‘
    url: 'https://webpack.js.org/'
description: webpack å…¥é—¨æ•™ç¨‹ï¼Œä»‹ç»äº†é€šè¿‡ä½¿ç”¨ webpack çš„ devServer é…ç½®çƒ­æ›´æ–°ä»¥åŠ HMR é…ç½®å±€éƒ¨çƒ­æ›´æ–°æ¥ä¼˜åŒ–æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡ã€‚
keywords:
  - webpack
  - webpack å…¥é—¨æ•™ç¨‹
  - webpack devServer
  - HMR
date: 2020-05-18 10:24:19
updated: 2020-05-20 15:19:00
sidebar_position: 4
---

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›é…ç½®æ¥ä¼˜åŒ–æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡ï¼Œwebpack çš„ devServer çƒ­æ›´æ–°ä»¥åŠ HMR å±€éƒ¨çƒ­æ›´æ–°ã€‚

<!--truncate-->

## DevServer

DevServer å¯ä»¥èµ·ä¸€ä¸ªæœ¬åœ°æœåŠ¡å¹¶ä¸”å®ç°ä»£ç çš„çƒ­æ›´æ–°ã€‚å¯ä»¥çœå»æˆ‘ä»¬æ¯æ¬¡æ›´æ–°ä»£ç åé‡å¯æœåŠ¡é¢æ“ä½œã€‚

```
npm i webpack-dev-server -D
```

é…ç½®æ–‡ä»¶

package.json

```json
"scripts": {
  "build": "webpack",
  "start": "webpack-dev-server"
},
```

webpack.config.js

```js
devServer: {
  contentBase: './dist',
  open: true, // è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  port: 3001, // æœåŠ¡å™¨ç«¯å£å·
},
```

æˆ‘ä»¬ä¹‹ååªéœ€è¦ä½¿ç”¨`npm run start`å°±å¯ä»¥æŠŠæœåŠ¡è·‘èµ·æ¥äº†ï¼Œä¹‹ååªè¦æ”¹åŠ¨ä»£ç å°±ä¼šè‡ªåŠ¨æ›´æ–°äº†ï¼Œå¼€å‘æ•ˆç‡æé«˜äº†å¾ˆå¤šæœ‰æ²¡æœ‰ ğŸ˜

:::info
devServer[æ›´å¤šé…ç½®å†…å®¹](https://webpack.js.org/configuration/dev-server/#devserver)
:::

## HMR å®ç°å±€éƒ¨çƒ­æ›´æ–°

HMRï¼ˆHot Module Replacementï¼‰

å½“æˆ‘ä»¬æ›´æ”¹äº†éƒ¨åˆ†æ–‡ä»¶åï¼Œæˆ‘ä»¬å‘ç° webpack-dev-server å¸®æˆ‘ä»¬é‡æ–°æ¸²æŸ“æ‰€æœ‰å†…å®¹ï¼Œå‡å¦‚æˆ‘åªæ”¹åŠ¨äº†ä¸€å°éƒ¨åˆ†ï¼Œåªæƒ³æ›´æ–°è¿™ä¸€éƒ¨åˆ†å†…å®¹å°±å¯ä»¥ç”¨äº†ä½¿ç”¨ HMR æ¥å®ç°äº†ã€‚

è¯´å†å¤šä¸å¦‚çœ‹ä¸€ä¸ªä¾‹å­

<Tabs>
<TabItem value="index.js" label="index.js">

```js
import './index.css';

var root = document.getElementById('root');

root.innerHTML = '<button id="btn">add new block</button>';

document.getElementById('btn').onclick = function () {
  var newBlock = document.createElement('p');
  newBlock.innerHTML = 'new Block';
  root.append(newBlock);
};
```

</TabItem>
<TabItem value="index.css" label="index.css">

```css
p {
  width: 100px;
}
p:nth-child(6) {
  background: red;
}
```

</TabItem>
</Tabs>

è¿™é‡Œä¾‹å­å°±æ˜¯ç‚¹å‡»æŒ‰é’®æ·»åŠ ä¸€ä¸ª p å…ƒç´ ï¼Œç¬¬ 6 ä¸ª p å…ƒç´ æ˜¾ç¤ºä¸ºçº¢è‰²èƒŒæ™¯

![](https://raw.githubusercontent.com/3Alan/images/master/img/hrmtest.gif)

è¿™ä¸ªæ—¶å€™æˆ‘è§‰å¾—çº¢è‰²ä¸å¥½çœ‹ï¼Œæƒ³æ¢æˆé»„è‰²ï¼Œä¿®æ”¹ï¼Œä¿å­˜ä¸€æ°”å‘µæˆã€‚

![image-20200518122346853](https://raw.githubusercontent.com/3Alan/images/master/img/image-20200518122346853.png)

ç»“æœ webpack-dev-server ç»™æˆ‘å…¨éƒ¨é‡æ–°æ¸²æŸ“äº†ï¼Œæˆ‘è¿˜è¦å†ç‚¹ 6 ä¸‹æ‰èƒ½çœ‹åˆ°æ•ˆæœï¼Œè¿™é‡Œå¦‚æœæ˜¯ 1000ï¼ˆè™½ç„¶ä¸å¤ªå¯èƒ½ï¼‰å‘¢ï¼Œé‚£æˆ‘å²‚ä¸æ˜¯è¦ç‚¹ 1000 ä¸‹ ğŸ˜±ã€‚

è¿™ä¸ªæ—¶å€™é…ç½® HRM å°±å¯ä»¥è½»æ¾è§£å†³è¿™ä¸ªé—®é¢˜äº†ã€‚

åªéœ€è¦å† webpack.config.js ä¸­é…ç½®

```js
devServer: {
  contentBase: './dist', // Tell the server where to serve content from
  open: true, // è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  port: 3001, // æœåŠ¡å™¨ç«¯å£å·
  hot: true, // å¼€å¯HRM
},
```

![](https://raw.githubusercontent.com/3Alan/images/master/img/blockTest.gif)

æå®š ğŸ˜ï¼Œä¸è¿‡è¿™é‡Œç”±äºæœ‰ css-loader å¸®æˆ‘ä»¬åšäº†ä¸€äº›æ›´æ–°çš„ä»»åŠ¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¹¶æ²¡æœ‰å†™è¿‡å¤šçš„ä»£ç ã€‚é‚£å¦‚æœæ²¡æœ‰ css-loader å¤„ç†é‚£æ€ä¹ˆåŠï¼Ÿä¸‹é¢çœ‹ä¸€ä¸‹å…·ä½“é…ç½®ã€‚

<Tabs>
<TabItem value="index.js" label="index.js">

```js
import Counter from './counter';
import Number from './number';

Counter();
Number();
```

</TabItem>
<TabItem value="counter.js" label="counter.js">

```js
function Counter() {
  var root = document.getElementById('root');
  var counter = document.createElement('div');
  counter.innerHTML = 0;
  counter.onclick = function () {
    counter.innerHTML = parseInt(counter.innerHTML, 10) + 1;
  };
  root.append(counter);
}

export default Counter;
```

</TabItem>
<TabItem value="number.js" label="number.js">

```js
function Number() {
  var root = document.getElementById('root');
  var data = document.createElement('div');
  data.setAttribute('id', 'number');
  data.innerHTML = '2000';
  root.append(data);
}

export default Number;
```

</TabItem>
</Tabs>

![](https://raw.githubusercontent.com/3Alan/images/master/img/test3.gif)

å¯ä»¥çœ‹åˆ°å½“æˆ‘ä¸€æ”¹å˜ numberï¼Œcounter ä¸­çš„çŠ¶æ€åˆé‡æ–°æ¸²æŸ“å˜æˆ 0 äº† ğŸ˜©ã€‚

è¿™é‡Œæˆ‘ä»¬å°±è¦é€šè¿‡ä¸€éƒ¨åˆ†ä»£ç æ¥å¤„ç†ä¸€ä¸‹äº†ï¼ˆcss-loader å°±æ˜¯å¸®æˆ‘ä»¬å®Œæˆäº†è¿™éƒ¨åˆ†å·¥ä½œï¼‰

```js
import Counter from './counter';
import Number from './number';

Counter();
Number();

if (module.hot) {
  // å¦‚æœå¼€å¯HMR
  module.hot.accept('./number.js', () => {
    var root = document.getElementById('root');
    root.removeChild(document.getElementById('number'));
    console.log('number is updated');
    Number();
    // ä¸€æ—¦number.jsæ–‡ä»¶æ”¹å˜ï¼Œè¿›è¡Œä¸€ç³»åˆ—å¤„ç†
  });
}
```

![](https://raw.githubusercontent.com/3Alan/images/master/img/test4.gif)

:::info
[HMR è¯¦ç»†æ–‡æ¡£](https://webpack.js.org/guides/hot-module-replacement/)
:::
